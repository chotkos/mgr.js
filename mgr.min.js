function Directive(a,b,c){this.name=a,this.init=b,this.template=c,this.getTemplateContent=function(a,b,c){directiveManager.container[b]=c;var d=$.get(a,function(a){c.element=a,directiveManager.container[b]=c});d.viewName=b,directiveManager.getPromises.push(d)},this.element=this.getTemplateContent(this.template,this.name,this)}function View(a,b,c,d){this.name=a,this.template=c,this.isIndex=d,this.init=b,this.render=function(a,c,d,e){b(c,e);var f=a[0];if(f.scope=a.scope,!d){var g=viewManager.mainUrl+"#"+this.name;null!=e&&void 0!=e&&(g+="?"+$.param(e)),window.location.href=g}$("html, body").animate({scrollTop:"0px"},300),binding.render(f,this.name)},this.getTemplateContent=function(b,c,e){viewManager.container[c]=e;var f=$.get(b,function(b){e.element=b,viewManager.container[c]=e,d&&(viewManager.indexViewName=a)});f.viewName=c,viewManager.getPromises.push(f),d&&viewManager.indexPromises.push(f)},this.element=this.getTemplateContent(this.template,this.name,this)}function Template(a){this.init=a;var b={};a(b);var c=$(document.body)[0];c.scope=b,binding.render(c,"template")}jQuery.extend({compareArrays:function(a,b){if(a.length!=b.length)return!1;for(var c=jQuery.extend(!0,[],a),d=jQuery.extend(!0,[],b),e=0,f=c.length;e<f;e++)if(JSON.stringify(c)!==JSON.stringify(d))return!1;return!0},queryStringToHash:function(a){for(var b={},c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]=decodeURIComponent(e[0]),e[1]=decodeURIComponent(e[1]),"undefined"==typeof b[e[0]])b[e[0]]=e[1];else if("string"==typeof b[e[0]]){var f=[b[e[0]],e[1]];b[e[0]]=f}else b[e[0]].push(e[1])}return b}}),String.prototype.replaceAll=function(a,b){var c=this;return c.split(a).join(b)};var dictionaries={errors:{},informations:{},warinings:{}};dictionaries.errors.viewLoadFail=function(a){return"Failed to load view: "+a},dictionaries.errors.noBackView=function(){return"There is no last view saved."},dictionaries.errors.cannotResolveBinding=function(){return"Cannot resolve binding."},dictionaries.errors.cannotRenderElement=function(){return"Failed to render element."},dictionaries.informations.templateRendering=function(){return"Template rendering."},dictionaries.informations.helloText=function(){return"mgr.js - let's graduate!"};var binding={mappedElements:[],mapObjects:[],directiveObjects:[],repeatElements:[],repeatObjects:[],renderElement:function(a,b,c){if(null==a)throw dictionaries.errors.cannotRenderElement();a.attributes["mgr-events"]&&this.renderEvents(a,b),a.attributes["mgr-repeat"]?this.renderRepeat(a,b,c):a.attributes.mgr&&!a.hasAttribute("istemplate")?this.renderProperties(a,c,b):a.attributes["mgr-dir"]&&this.renderDirective(a,this,b,c)},renderRepeat:function(renderedElement,element,viewName){for(var interpValues=renderedElement.getAttribute("mgr-repeat").split(" "),alias=interpValues[0],collectionName=interpValues[2],collectionData=JSON.parse(JSON.stringify(eval(collectionName.replaceAll("scope","element.scope")))),template=renderedElement,tplHtml=$(renderedElement).html(),parent=renderedElement.parentNode,toMark=template.getElementsByTagName("*"),zi=0;zi<toMark.length;zi++)$(toMark[zi]).attr("isTemplate","true");template.hidden=!0;for(var k=0;k<collectionData.length;k++){var e=document.createElement(template.tagName);$(e).html(tplHtml),e.scope=collectionData[k],$(e).html($(e).html().replaceAll(alias,collectionName+"["+k+"]")),$(parent).append(e);var all=[];all.push.apply(all,e.getElementsByTagName("*"));for(var ww=0;ww<all.length;ww++)this.renderElement(all[ww],element,viewName)}this.repeatObjects.push({viewName:viewName,element:renderedElement,data:collectionData,renderElement:element,collectionName:collectionName.replaceAll("scope","element.scope")})},renderProperties:function(renderedElement,viewName,element){if(jQuery.contains(document,renderedElement)){this.mappedElements.push(renderedElement);for(var interpKeys=eval(renderedElement.getAttribute("mgr")),l=0;l<interpKeys.length;l++){var interpKey=interpKeys[l],splitArray=interpKey.split(" "),method=splitArray[0];splitArray.shift();var params=splitArray,o={viewName:viewName,element:renderedElement,interpKey:interpKey,method:method,params:params,oldValueOnElement:null,oldValueOnResource:null,scopeOwner:element,mapFromResource:function(){var p1=this.params[0]?this.params[0].replaceAll("scope.","this.scopeOwner.scope."):"",p2=this.params[1]?this.params[1].replaceAll("scope.","this.scopeOwner.scope."):"";p1.indexOf("scope")!=-1&&(p1=eval(p1)),p2.indexOf("scope")!=-1&&(p2=eval(p2)),eval("$(this.element)[this.method](p1,p2)")},mapFromElement:function(){var field=null,value=null;this.params.length>1?(field="this.scopeOwner."+this.params[1],value="$(this.element)[this.method](this.params[0])"):(field="this.scopeOwner."+this.params[0],value="$(this.element)[this.method]()"),eval(field+"="+value)}};o.mapFromResource(),o.oldValueOnElement=this.getMapObjectOldValueOnElement(o),o.oldValueOnResource=this.getMapObjectOldValueOnResource(o),null===this?this.mapObjects.push(o):this.mapObjects.push(o)}}},renderEvents:function(renderedElement,element){for(var interpValues=eval(renderedElement.getAttribute("mgr-events")),z=0;z<interpValues.length;z++){var split=interpValues[z].split(" "),ind=interpValues[z].indexOf(" "),fun=interpValues[z].substring(ind);fun=fun.replaceAll("scope","element.scope"),$(renderedElement).off(split[0]),$(renderedElement).on(split[0],function(){eval(fun)})}},renderDirective:function(a,b,c,d){var e=a.getAttribute("mgr-dir"),f=e.split(" "),g=f[0].trim(),h=e.substr(g.length,e.length-1).trim();f=[g,h];var i=directiveManager.container[g];f.length>1&&$(a).html(i.element.replaceAll("scope",f[1]));for(var j=a.getElementsByTagName("*"),k=0;k<j.length;k++)this.renderElement(j[k],c,d);var l=f[1].replaceAll("scope.","element.scope."),m={directiveDefinition:i,element:a,renderElement:c,viewName:d,name:g,directiveArgs:l,parent:a.parentNode};this.directiveObjects.push(m)},render:function(a,b){var c=a.getElementsByTagName("*");"template"==b&&console.log(dictionaries.informations.templateRendering());for(var d=0;d<c.length;d++)this.renderElement(c[d],a,b);this.timerRun()},timerFunction:function(context){for(var z=0;z<context.repeatObjects.length;z++){var ro=context.repeatObjects[z];if(ro.viewName===viewManager.activeViewName){var element=ro.renderElement,newValues=eval(ro.collectionName);if(!jQuery.compareArrays(ro.data,newValues)){for(var template=$(ro.element).html();void 0!=ro.element.parentElement.children[1];)ro.element.parentElement.children[1].remove();for(var interpValues=ro.element.getAttribute("mgr-repeat").split(" "),alias=interpValues[0],collectionName=interpValues[2],collectionData=eval(collectionName.replaceAll("scope","element.scope")),template=ro.element,tplHtml=$(ro.element).html(),parent=ro.element.parentNode,toMark=template.getElementsByTagName("*"),zi=0;zi<toMark.length;zi++)$(toMark[zi]).attr("isTemplate","true");template.hidden=!0,tplHtml=tplHtml.replaceAll(/istemplate="true"/g,"");for(var k=0;k<collectionData.length;k++){var e=document.createElement(template.tagName);$(e).html(tplHtml),e.scope=collectionData[k],$(e).html($(e).html().replaceAll(alias,collectionName+"["+k+"]")),$(parent).append(e);var all=[];all.push.apply(all,e.getElementsByTagName("*"));for(var ww=0;ww<all.length;ww++)context.renderElement(all[ww],ro.renderElement,ro.viewName)}ro.data=JSON.parse(JSON.stringify(newValues))}}}for(var newMO=[],ki=0;ki<context.mapObjects.length;ki++)context.mapObjects[ki].viewName==viewManager.activeViewName&&document.contains(context.mapObjects[ki].element)&&newMO.push(context.mapObjects[ki]);context.mapObjects=newMO;for(var k=0;k<context.mapObjects.length;k++){var c=context.mapObjects[k];if(!c.element.hasAttribute("istemplate")){var oldValueOnElement=c.oldValueOnElement,newValueOnElement=context.getMapObjectOldValueOnElement(c);oldValueOnElement!=newValueOnElement&&(c.mapFromElement(context),c.oldValueOnElement=context.getMapObjectOldValueOnElement(c));var oldValueOnResource=c.oldValueOnResource,newValueOnResource=context.getMapObjectOldValueOnResource(c);oldValueOnResource!=newValueOnResource&&(c.mapFromResource(context),c.oldValueOnResource=context.getMapObjectOldValueOnResource(c),c.oldValueOnElement=oldValueOnResource)}}},timerRun:function(){setInterval(this.timerFunction.bind(null,this),500)},getMapObjectOldValueOnElement:function(a){var b=null;return b=a.params.length>1?$(a.element)[a.method](a.params[0]):$(a.element)[a.method]()},getMapObjectOldValueOnResource:function(mo){try{var text=mo.params[mo.params.length-1];return eval("mo.scopeOwner."+text)}catch(a){throw dictionaries.errors.cannotResolveBinding()}}},directiveManager={container:{},getPromises:[]},viewManager={indexViewName:null,activeView:null,activeViewName:null,lastViewName:null,lastViewParams:null,activeScope:null,container:{},indexPromises:[],getPromises:[],mainUrl:window.location.href,renderView:function(a,b,c){if(this.lastViewName=this.activeViewName,this.lastViewParams=c,!this.container[a])throw dictionaries.errors.viewLoadFail(a);this.activeView=this.container[a];var d=$("#mgrapp");d.html(this.activeView.element),d.scope={},this.activeScope=d.scope,this.activeViewName=this.activeView.name,this.activeView.render(d,d.scope,b,c)},moveBack:function(){this.lastViewName?this.renderView(this.lastViewName,!1,this.lastViewParams):console.warn(dictionaries.errors.noBackView())},getMainUrl:function(){var a=window.location.href.lastIndexOf("#");a!=-1?this.mainUrl=window.location.href.substr(0,a):this.mainUrl=window.location.href}};document.onmouseover=function(){window.docClick=!0},document.onmouseleave=function(){window.docClick=!1},window.onhashchange=function(){window.docClick||viewManager.moveBack()},$(function(){var a=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(b){8==b.which&&(!a.test(b.target.tagName)||b.target.disabled||b.target.readOnly)&&(b.preventDefault(),viewManager.moveBack())})}),View.prototype.getName=function(){return this.name};var mgrStart=function(){var a=function(){$.when.apply($,viewManager.indexPromises).then(function(){$.when.apply($,directiveManager.getPromises).then(function(){console.log(dictionaries.informations.helloText()),viewManager.getMainUrl();var a=null;if(window.location.href.lastIndexOf("#")!=-1){var b=window.location.href.split("#");if(b=b[b.length-1],b.indexOf("?")!=-1){var c=b.split("?");b=c[0],a=jQuery.queryStringToHash(c[1])}void 0!=viewManager.container[b]&&viewManager.renderView(b,!0,a)}else null!=viewManager.indexViewName&&viewManager.renderView(viewManager.indexViewName,!1,a)})})};if(window.location.href.lastIndexOf("#")!=-1){var b=window.location.href.split("#");if(b=b[b.length-1],b.indexOf("?")!=-1){var c=b.split("?");b=c[0]}for(var d=0;d<viewManager.getPromises.length;d++){var e=viewManager.getPromises[d];e.viewName===b&&(viewManager.indexPromises=[e])}a()}else a()};